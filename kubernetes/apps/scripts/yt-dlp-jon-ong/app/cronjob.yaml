---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: &app yt-dlp-jon-ong
  namespace: scripts
  labels:
    app: *app
spec:
  schedule: '30 17 * * *'
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      backoffLimit: 0
      template:
        spec:
          automountServiceAccountToken: false
          containers:
            - name: *app
              image: ghcr.io/truxnell/yt-dlp:2023.01.06@sha256:802b09d9f5a02ca4b8e8fdfe5d82c3a0f875c0ee1d6b20939511cfaedd10a78e
              imagePullPolicy: IfNotPresent
              command: ['/usr/local/bin/yt-dlp']
              args:
                - -f
                - ba
                - https://www.youtube.com/c/JonathanOng/videos
                - --remux-video
                - opus
                - -o
                - /music/Jonathan Ong/Twitch Highlights/%(title)s.%(ext)s
                - --download-archive
                - /music/Jonathan Ong/Twitch Highlights/ytdlhistory.txt
                - --add-metadata
                - --embed-thumbnail
                - --parse-metadata
                - Twitch Highlights:%(meta_album)s
                - --parse-metadata
                - Jonathan Ong:%(meta_artist)s
                - --parse-metadata
                - Jonathan Ong:%(meta_album_artist)s
              volumeMounts:
                - mountPath: /music
                  name: nas
          restartPolicy: Never
          volumes:
            - name: nas
              nfs:
                server: 'george.${INTERNAL_DOMAIN}'
                path: /tank/music/
