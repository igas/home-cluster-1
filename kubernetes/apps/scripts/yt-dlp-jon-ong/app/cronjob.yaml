---


# yaml-language-server: $schema=https://kubernetes-schemas.trux.dev/batch/cronjob_v1.json
apiVersion: batch/v1
kind: CronJob
metadata:
  name: &app yt-dlp-jon-ong
  namespace: scripts
  labels:
    app: *app
spec:
  schedule: '30 17 * * *'
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      backoffLimit: 0
      template:
        spec:
          automountServiceAccountToken: false
          containers:
            - name: *app
              image: ghcr.io/truxnell/yt-dlp:2023.03.04@sha256:7e073a61c06bb3dbfadf82131e847cff5409afebf2bffdf76ff78db0bdd0a474
              imagePullPolicy: IfNotPresent
              command: ['/wrapper.sh']
              args:
                - -f
                - ba
                - https://www.youtube.com/c/JonathanOng/videos
                - --remux-video
                - opus
                - -o
                - /music/Jonathan Ong/Twitch Highlights/%(title)s.%(ext)s
                - --download-archive
                - /music/Jonathan Ong/Twitch Highlights/ytdlhistory.txt
                - --add-metadata
                - --embed-thumbnail
                - --parse-metadata
                - Twitch Highlights:%(meta_album)s
                - --parse-metadata
                - Jonathan Ong:%(meta_artist)s
                - --parse-metadata
                - Jonathan Ong:%(meta_album_artist)s
              volumeMounts:
                - mountPath: /music
                  name: nas
          restartPolicy: Never
          volumes:
            - name: nas
              nfs:
                server: 'helios.${INTERNAL_DOMAIN}'
                path: /tank/music/
