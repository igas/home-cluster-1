---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: homer
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://k8s-at-home.com/charts/
      chart: homer
      version: 4.4.0
      sourceRef:
        kind: HelmRepository
        name: k8s-at-home-charts
        namespace: flux-system
      interval: 5m
  test:
    enable: true
  # install:
  #   remediation:
  #     retries: 3
  upgrade:
    remediation:
      remediateLastFailure: true
    cleanupOnFail: true
  rollback:
    timeout: 10m
    recreate: true
    cleanupOnFail: true
  # Values link: https://github.com/k8s-at-home/charts/blob/master/charts/stable/homer/values.yaml
  values:
    env:
      TZ: "Australia/Melbourne"
    resources:
      requests:
        memory: 250Mi
        cpu: 500m
      limits:
        memory: 1500Mi
        cpu: 2000m
    persistence:
      config:
        enabled: true
        storageClass: "longhorn"
        size: 1Gi
    addons:
      codeserver:
        enabled: true
        workingDir: "/www/assets"
        image:
          repository: codercom/code-server
          tag: 3.9.2
        args:
          - --user-data-dir
          - "/www/assets/.vscode"
          - --auth
          - "none"
        volumeMounts:
          - name: config
            mountPath: /www/assets
    configmap:
      # -- Store homer configuration as a ConfigMap
      enabled: true
      # -- Homer configuration
      # https://github.com/bastienwirtz/homer/blob/main/docs/configuration.md
      config: |
        ---
        title: "Homer"
        subtitle: "Dashboard"
        logo: "assets/tools/badge.png"
        footer: false

        links:
          - name: "Home-Cluster"
            icon: "fab fa-git-alt"
            url: "https://github.com/Truxnell/home-cluster"
          - name: "Webmail"
            icon: "fas fa-envelope"
            url: "https://runbox.com/app/#Inbox/"

        services:
          - name: "Multimedia"
            icon: "fas fa-film"
            items:
              # - name: "Jellyfin"
              #   logo: "assets/tools/jellyfin.png"
              #   subtitle: "Managing + Streaming Media"
              #   tag: "Streaming"
              #   url: "https://{{jellyfin_tld}}/"
              - name: "Sonarr"
                logo: "assets/tools/sonarr.png"
                subtitle: "TV Show PVR for Usenet + BitTorrent"
                url: "https://sonarr.${CLUSTER_DOMAIN}/"
                tag: "tv"
              - name: "Radarr"
                logo: "assets/tools/radarr.png"
                subtitle: "Movie PVR for Usenet + BitTorrent"
                url: "https://radarr.${CLUSTER_DOMAIN}/"
                tag: "movies"
              # - name: "Lidarr"
              #   logo: "assets/tools/lidarr.png"
              #   subtitle: "Music PVR for Usenet + BitTorrent"
              #   url: "https://lidarr.${CLUSTER_DOMAIN}/"
              #   tag: "music"
              # - name: "Readarr"
              #   logo: "assets/tools/readarr.png"
              #   subtitle: "eBook PVR for Usenet + BitTorrent"
              #   url: "https://readarr.${CLUSTER_DOMAIN}/"
              #   tag: "eBook"
              - name: "NZBGet"
                logo: "assets/tools/nzbget.png"
                subtitle: "Easy Binary Newsreader"
                url: "https://nzbget.${CLUSTER_DOMAIN}/"
                tag: "usenet"
              # - name: "Qbittorrent"
              #   logo: "assets/tools/qbittorrent.png"
              #   subtitle: "Cross-Platform BitTorrent client"
              #   url: "https://qbittorrent.${CLUSTER_DOMAIN}/"
              #   tag: "torrents"
              - name: "Hydra"
                logo: "assets/tools/hydra.png"
                subtitle: "Meta Search for NZB Indexers"
                url: "https://nzbhydra.${CLUSTER_DOMAIN}/"
                tag: "usernet"
              # - name: "Jackett"
              #   logo: "assets/tools/jackett.png"
              #   subtitle: "API Support for Torrent Trackers"
              #   url: "https://jackett.${CLUSTER_DOMAIN}/"

          - name: "Cloud"
            icon: "fas fa-cloud"
            items:
              - name: "Bitwarden"
                logo: "assets/tools/bitwarden.png"
                subtitle: "Open Source Password Management"
                url: "https://bitwarden.${CLUSTER_DOMAIN}/"
                tag: "passwords"
              # - name: "Airsonic"
              #   logo: "assets/tools/airsonic.png"
              #   subtitle: "Community Driven Media Server"
              #   url: "https://music.${CLUSTER_DOMAIN}/"
              #   tag: "Music"
              # - name: "Element"
              #   logo: "assets/tools/element.png"
              #   subtitle: "A Glossy Matrix Collaboration Client"
              #   url: "https://element.{{chat_tld}}/#/login"
              #   tag: "Messaging"
              # - name: "FreshRSS"
              #   logo: "assets/tools/freshrss.png"
              #   subtitle: "Self Hostable Aggregator"
              #   url: "https://rss.${CLUSTER_DOMAIN}/"
              #   tag: "RSS"
              # - name: "Wallabag"
              #   logo: "assets/tools/wallabag.png"
              #   subtitle: "Save + Classify Articles"
              #   url: "https://wallabag.${CLUSTER_DOMAIN}/"
              #   tag: "Bookmarks"
              # - name: "Kutt"
              #   logo: "assets/tools/kutt.png"
              #   subtitle: "Free Modern URL Shortener"
              #   url: "https://{{kutt_tld}}/"
              #   tag: "URL"
              # - name: "Firefly"
              #   logo: "assets/tools/firefly.png"
              #   subtitle: "Personal Finance Manager"
              #   url: "https://firefly.${CLUSTER_DOMAIN}/"
              #   tag: "Finances"
              - name: "Home Assistant"
                logo: "assets/tools/homeassistant.png"
                subtitle: "Free & Open Source Home Automation"
                url: "https://homeassistant.${CLUSTER_DOMAIN}/"
                tag: "hass"
              - name: "Traefik"
                logo: "assets/tools/minio.png"
                subtitle: "Cloud-native Application Networking Stack"
                url: "https://traefik.${CLUSTER_DOMAIN}/dashboard/"
                tag: "traefik"
              - name: "Pterodactyl"
                logo: "assets/tools/pterodactyl.png"
                subtitle: "Kubernetes-Native Game Server Hosting"
                url: "https://pterodactyl.${CLUSTER_DOMAIN}/dashboard/"
                tag: "games"


          - name: "Storage"
            icon: "fas fa-database"
            items:
              - name: "Minio"
                logo: "assets/tools/minio.png"
                subtitle: "S3 Compatible Object Storage Server"
                url: "https://minio.${CLUSTER_DOMAIN}/"
                tag: "s3"
              - name: "Longhorn"
                logo: "assets/tools/longhorn.png"
                subtitle: "Cloud native distributed block storage for Kubernetes"
                url: "https://longhorn.${CLUSTER_DOMAIN}/"
                tag: "longhorn"
              - name: "Webdav"
                logo: "assets/tools/webdav.png"
                subtitle: "Web-based Distributed Authoring and Versioning"
                url: "https://webdav.${CLUSTER_DOMAIN}/"
                tag: "webdav"
              - name: "Synology"
                logo: "assets/tools/synology.png"
                subtitle: "Local file storage"
                url: "https://syno.${CLUSTER_DOMAIN}/"
                tag: "syno"
              # - name: "PeerTube"
              #   logo: "assets/tools/peertube.png"
              #   subtitle: "Decentralized + Federated Video Platform"
              #   url: "https://{{peertube_tld}}/"
              #   tag: "Streaming"
              # - name: "Teedy"
              #   logo: "assets/tools/teedy.png"
              #   subtitle: "Lightweight Document Management"
              #   url: "https://docs.${CLUSTER_DOMAIN}/"
              #   tag: "Documents"
              # - name: "Photoprism"
              #   logo: "assets/tools/photoprism.png"
              #   subtitle: "Browse, Organize & Share Photos"
              #   url: "https://{{photo_tld}}/"
              #   tag: "Photos"
              # - name: "Pyload"
              #   logo: "assets/tools/pyload.png"
              #   subtitle: "Download Manager Written in Python"
              #   url: "https://download.${CLUSTER_DOMAIN}/"
              #   tag: "Downloads"
              # - name: "NetBootxyz"
              #   logo: "assets/tools/netbootxyz.png"
              #   subtitle: "Network Bootable Images for iPXE"
              #   url: "https://netboot.${CLUSTER_DOMAIN}/"

          - name: "Monitoring"
            icon: "fas fa-heartbeat"
            items:
              # - name: "Grafana"
              #   logo: "assets/tools/grafana.png"
              #   subtitle: "Metrics, Analytics + Dashboards"
              #   url: "https://dashboard.${CLUSTER_DOMAIN}/"
              #   tag: "Dashboard"
              # - name: "Kibana"
              #   logo: "assets/tools/elastic.png"
              #   subtitle: "Explore + Visualize Logs"
              #   tag: "ELK"
              #   url: "https://kibana.${CLUSTER_DOMAIN}/"
              # - name: "OPNsense"
              #   logo: "assets/tools/opnsense.png"
              #   subtitle: "FreeBSD-Based Firewall + Routing"
              #   url: "https://opnsense.${CLUSTER_DOMAIN}/"
              #   tag: "Firewall"
              # - name: "Traefik"
              #   logo: "assets/tools/traefik.png"
              #   subtitle: "Open Source Edge Router"
              #   url: "https://api.${CLUSTER_DOMAIN}/"
              # - name: "Tdarr"
              #   logo: "assets/tools/tdarr.png"
              #   subtitle: "Library Analytics + Transcode Automation"
              #   url: "https://tdarr.${CLUSTER_DOMAIN}/"
              # - name: "Bazarr"
              #   logo: "assets/tools/bazarr.png"
              #   subtitle: "Manage + Download Subtitles"
              #   url: "https://bazarr.${CLUSTER_DOMAIN}/"

          - name: "DevOps"
            icon: "fas fa-code-branch"
            items:
              # - name: "Gitea"
              #   logo: "assets/tools/gitea.png"
              #   subtitle: "Self-Hosted Git Service"
              #   url: "https://{{git_tld}}/"
              #   tag: "Git"
              # - name: "Jenkins"
              #   logo: "assets/tools/jenkins.png"
              #   subtitle: "The leading Open Source Automation Server"
              #   url: "https://ci.{{git_tld}}/"
              #   tag: "CI/CD"
              - name: "Keycloak"
                logo: "assets/tools/keycloak.png"
                subtitle: "Authorization Service"
                url: "https://keycloak.${CLUSTER_DOMAIN}/"
                tag: "registry"
              # - name: "Visual Studio Code"
              #   logo: "assets/tools/code.png"
              #   subtitle: "Integrated Development Environment"
              #   url: "https://ide.{{git_tld}}/"
              #   tag: "IDE"
              # - name: "Leantime"
              #   logo: "assets/tools/leantime.png"
              #   subtitle: "Kanban Board + Project Managment"
              #   url: "https://leantime.${CLUSTER_DOMAIN}/"
              #   tag: "Kanban"
              # - name: "CyberChef"
              #   logo: "assets/tools/cyberchef.png"
              #   subtitle: "The Cyber Swiss Army Knife"
              #   url: "https://cyberchef.${CLUSTER_DOMAIN}/"

          - name: "Tools"
            icon: "fas fa-hammer"
            items:
              # - name: "FreePBX"
              #   logo: "assets/tools/freepbx.png"
              #   subtitle: "Open Source Private Branch Exchange"
              #   url: "https://pbx.${CLUSTER_DOMAIN}/"
              #   tag: "PBX"
              # - name: "FreeIPA"
              #   logo: "assets/tools/freeipa.png"
              #   subtitle: "Open Source Identity Management System"
              #   url: "https://freeipa.${CLUSTER_DOMAIN}/"
              #   tag: "DNS"
              # - name: "Cups"
              #   logo: "assets/tools/cups.png"
              #   subtitle: "Modular Printing System"
              #   url: "https://print.${CLUSTER_DOMAIN}/"
              #   tag: "Print"
              # - name: "Guacamole"
              #   logo: "assets/tools/guacamole.png"
              #   subtitle: "Clientless Remote Desktop Gateway"
              #   url: "https://guac.${CLUSTER_DOMAIN}/"
              # - name: "Podify"
              #   logo: "assets/tools/podify.png"
              #   subtitle: "Create Podcasts from Anything"
              #   url: "https://podify.${CLUSTER_DOMAIN}/"
              - name: "Proxmox"
                logo: "assets/tools/proxmox.png"
                subtitle: "Open Source Enterprise Virtualization"
                url: "https://proxmox.${CLUSTER_DOMAIN}/"
              - name: "Brewpiless"
                logo: "assets/tools/brewpiless.png"
                subtitle: "Homebrew Temperature Controller"
                url: "https://brewpiless.${CLUSTER_DOMAIN}/"
