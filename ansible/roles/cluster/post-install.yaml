---
- name: Create Docker secret
  shell: |
    {{ KUBECTL_BIN }} create secret docker-registry regcred \
    --docker-username={{ DOCKER_USER }} \
    --docker-password={{ DOCKER_PASSWORD }} \
  # --docker-server=<your-registry-server> \
  # --docker-email=<your-email>
  register: result
  failed_when:
  - "'already exists' not in result.stderr"
  - result.rc != 0
  changed_when:
  - "'already exists'  not in result.stderr|join('')"
  retries: 60
  delay: 5

