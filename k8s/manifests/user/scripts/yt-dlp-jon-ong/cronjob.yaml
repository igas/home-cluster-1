---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: &app yt-dlp-jon-ong
  namespace: scripts
  labels:
    app: *app
spec:
  schedule: "30 17 * * *"
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          automountServiceAccountToken: false

          containers:
            - name: *app
              image: ghcr.io/truxnell/container-images/yt-dlp:latest
              imagePullPolicy: IfNotPresent
              args:
                [
                  "-f",
                  "ba",
                  "https://www.youtube.com/c/JonathanOng/videos",
                  "--remux-video",
                  "opus",
                  "-o",
                  "/music/Jonathan Ong/Twitch Highlights/%(title)s.%(ext)s",
                  "--download-archive",
                  "/music/Jonathan Ong/Twitch Highlights/yt-dl-history.txt",
                  "--add-metadata",
                  "--embed-thumbnail",
                  "--parse-metadata",
                  "Twitch Highlights:%(meta_album)s",
                  "--parse-metadata",
                  "Jonathan Ong:%(meta_artist)s",
                  "--xattrs",
                ]
              volumeMounts:
                - mountPath: /music
                  name: nas

          restartPolicy: OnFailure

          volumes:
            - name: nas
              nfs:
                server: "george.${INTERNAL_DOMAIN}"
                path: /tank/music/
